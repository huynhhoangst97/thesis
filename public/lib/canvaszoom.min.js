function CanvasZoom(e,aa,Z,H){var P=this;var w=1;var Y=256;var y=false;var L=0;var j=0;var J=-1;var Q=-1;var X=0;var W=0;var m=0;var k=0;var o=0;var n=0;var U=0;var T=0;var f=false;var u=false;var d=0;var c=0;var x="w";var D="h";var G="t";var s="wt";var O=null;var i=null;var r=null;var A=function(ab,t,ac){return""+aa+"/"+ab+"/"+t+"_"+ac+".jpg"};var g=function(){j=Math.ceil(Math.log(Math.max(Z,H))/Math.LN2);O=new Array(j);var ah=Z;var aj=H;var ae=-1;for(var t=j;t>=L;t--){var ad=Math.ceil(ah/Y);var ai=Math.ceil(aj/Y);if(J==-1&&ah<=Y&&aj<=Y){J=t}if(ae==-1&&ah<=e.width&&aj<=e.height){ae=t}O[t]=new Array(ad);for(var af=0;af<ad;af++){O[t][af]=new Array(ai)}O[t][x]=ah;O[t][D]=aj;for(var af=0;af<ad;af++){for(var ag=0;ag<ai;ag++){O[t][af][ag]=new Array();O[t][af][ag][G]=null;O[t][af][ag][s]=false}}ah/=2;aj/=2}Q=ae;var ac=new Array();var ab=0;var ad=O[Q].length;var ai=O[Q][0].length;for(var af=0;af<ad;af++){for(var ag=0;ag<ai;ag++){ac.push({id:ab++,file:A(Q,af,ag)})}}ac.push({id:ab,file:A(J,0,0)});i=new ImageLoader({images:ac,onAllLoaded:function(){a()}})};var a=function(){var ab=O[Q];var ad=ab.length;var ae=ab[0].length;var ac=0;for(var t=0;t<ad;t++){for(var af=0;af<ae;af++){ab[t][af][G]=i.getImageById(ac++)}}O[J][0][0][G]=i.getImageById(ac);d=(e.width-ab[x])/2;c=(e.height-ab[D])/2;e.addEventListener("mousemove",function(ag){l(V(ag))},true);e.addEventListener("mousedown",function(ag){h(V(ag))},true);e.addEventListener("mouseup",function(ag){b(V(ag))},true);e.addEventListener("mouseout",function(ag){F(V(ag))},true);e.addEventListener("mouseover",function(ag){M(V(ag))},true);e.addEventListener("DOMMouseScroll",function(ag){B(V(ag))},true);e.addEventListener("mousewheel",function(ag){B(V(ag))},true);window.addEventListener("mouseup",function(ag){q(V(ag))},false);window.addEventListener("mousemove",function(ag){N(V(ag))},false);r=e.getContext("2d");S()};var V=function(t){if(!t){t=window.event}return t};var h=function(t){f=true;u=false;m=K(t);k=I(t);U=m;T=k};var b=function(t){f=false;u=false;X=K(t);W=I(t);if(X==m&&W==k){z()}};var l=function(ac){X=K(ac);W=I(ac);if(f){var ab=d+(X-U);var t=c+(W-T);v(Q,ab,t);U=X;T=W;d=ab;c=t;S()}};var K=function(ab){var t=0;if(ab.layerX||ab.layerX==0){t=ab.layerX-e.offsetLeft}else{if(ab.offsetX||ab.offsetX==0){t=ab.offsetX}}return t};var I=function(t){var ab=0;if(t.layerY||t.layerY==0){ab=t.layerY-e.offsetTop}else{if(t.offsetY||t.offsetY==0){ab=t.offsetY}}return ab};var F=function(t){if(f){u=true}};var M=function(t){u=false};var B=function(t){var ab=0;if(t.wheelDelta){ab=t.wheelDelta/120;if(window.opera){ab=-ab}}else{if(t.detail){ab=t.detail/3}}if(ab){if(ab<0){z()}else{p()}}if(t.preventDefault){t.preventDefault()}t.returnValue=false};var q=function(t){if(f&&u){b(t)}};var N=function(t){if(f&&u){l(t)}};var z=function(){R(Q+1);S()};var p=function(){R(Q-1);S()};this.zoomInCentre=function(){X=e.width/2;W=e.height/2;z()};this.zoomOutCentre=function(){X=e.width/2;W=e.height/2;p()};var R=function(ac){if(ac>=L&&ac<=j){var af=ac,aj=Q;var ai=X;var ah=W;var ab=ai-d,t=ah-c;var ad=O[af][x]/O[aj][x];var al=ab*ad,ak=t*ad;var ag=d-(al-ab),ae=c-(ak-t);v(af,ag,ae);Q=af;d=ag;c=ae}};var v=function(t,al,ak){var af=O[t];var ar=Y/2;var an=-al,aq=-ak;var ac=an+e.width,at=aq+e.height;var ad=0,aj=0,au=0,ae=0;var av=null;var ah=af[x],ag=af[D];var ab=af.length,am=af[0].length;var ao=new Array();for(var ap=0;ap<ab;ap++){for(var ai=0;ai<am;ai++){av=af[ap][ai];if(av[G]==null&&av[s]==false){ad=ap*Y;aj=ad+Math.min(Y,ah-ad);au=ai*Y;ae=au+Math.min(Y,ag-au);if(!(ad>ac||aj<an||au>at||ae<aq)){av[s]=true;ao.push({name:t+"_"+ap+"_"+ai,file:A(t,ap,ai)})}}}}E(ao)};var E=function(t){if(t.length>0){i=new ImageLoader({images:t,onImageLoaded:function(ab,ac){C(ab,ac)}})}};var C=function(ab,ac){var ad=ab.split("_");if(ad.length==3){var t=O[ad[0]][ad[1]][ad[2]];t[G]=ac;t[s]=false;S()}};var S=function(){var at=e.width,t=e.height;r.fillStyle=r.strokeStyle="#fff";r.clearRect(0,0,at,t);var af=O[Q];var ab=af.length,am=af[0].length;var ao=-d,aq=-c;var ac=ao+at,ar=aq+t;var ad=0,aj=0,au=0,ae=0;var an=0;var aw=null;var ah=af[x];var ag=af[D];var av=O[J][0][0][G];for(var ap=0;ap<ab;ap++){for(var ai=0;ai<am;ai++){ad=ap*Y;aj=ad+Math.min(Y,ah-ad);au=ai*Y;ae=au+Math.min(Y,ag-au);if(!(ad>ac||aj<ao||au>ar||ae<aq)){aw=af[ap][ai][G];ad+=d;aj+=d;au+=c;ae+=c;if(aw!=null){r.drawImage(aw,ad,au);if(y){r.strokeRect(ad,au,Y,Y);an++}}else{if(true){r.save();r.beginPath();r.moveTo(ad,au);r.lineTo(aj,au);r.lineTo(aj,ae);r.lineTo(ad,ae);r.closePath();r.clip();r.drawImage(av,d,c,ah,ag);r.restore()}else{r.fillStyle="#999";r.fillRect(ad,au,aj-ad,ae-au)}}}}}r.strokeStyle="#000";r.strokeRect(0,0,at,t);if(y){r.fillStyle="#0f0";r.font="normal 12px Arial";r.fillText(X+","+W+" | "+d+","+c+" | "+an,0,20);r.strokeStyle="#f00";for(var ak=0;ak<t;ak+=Y){for(var al=0;al<at;al+=Y){r.strokeRect(al,ak,Y,Y)}}}};g()};

